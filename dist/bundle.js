(()=>{"use strict";const e="pf2e-adjust-monster-level",t="testMode",i=["-1","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"];var a,r;!function(e){e.name="PF2EADJUSTMONSTERLEVEL.name",e.level="PF2EADJUSTMONSTERLEVEL.level",e.str="PF2EADJUSTMONSTERLEVEL.str",e.dex="PF2EADJUSTMONSTERLEVEL.dex",e.con="PF2EADJUSTMONSTERLEVEL.con",e.int="PF2EADJUSTMONSTERLEVEL.int",e.wis="PF2EADJUSTMONSTERLEVEL.wis",e.cha="PF2EADJUSTMONSTERLEVEL.cha",e.hp="PF2EADJUSTMONSTERLEVEL.hp",e.perception="PF2EADJUSTMONSTERLEVEL.perception",e.ac="PF2EADJUSTMONSTERLEVEL.ac",e.resistWeak="PF2EADJUSTMONSTERLEVEL.resistWeak",e.fortitude="PF2EADJUSTMONSTERLEVEL.fortitude",e.reflex="PF2EADJUSTMONSTERLEVEL.reflex",e.will="PF2EADJUSTMONSTERLEVEL.will",e.strikeBonus="PF2EADJUSTMONSTERLEVEL.strikeBonus",e.strikeDamage="PF2EADJUSTMONSTERLEVEL.strikeDamage",e.spellcasting="PF2EADJUSTMONSTERLEVEL.spellcasting",e.spellDC="PF2EADJUSTMONSTERLEVEL.spellDC",e.acrobatics="PF2EADJUSTMONSTERLEVEL.acrobatics",e.arcana="PF2EADJUSTMONSTERLEVEL.arcana",e.athletics="PF2EADJUSTMONSTERLEVEL.athletics",e.crafting="PF2EADJUSTMONSTERLEVEL.crafting",e.deception="PF2EADJUSTMONSTERLEVEL.deception",e.diplomacy="PF2EADJUSTMONSTERLEVEL.diplomacy",e.intimidation="PF2EADJUSTMONSTERLEVEL.intimidation",e.medicine="PF2EADJUSTMONSTERLEVEL.medicine",e.nature="PF2EADJUSTMONSTERLEVEL.nature",e.occultism="PF2EADJUSTMONSTERLEVEL.occultism",e.performance="PF2EADJUSTMONSTERLEVEL.performance",e.religion="PF2EADJUSTMONSTERLEVEL.religion",e.society="PF2EADJUSTMONSTERLEVEL.society",e.stealth="PF2EADJUSTMONSTERLEVEL.stealth",e.survival="PF2EADJUSTMONSTERLEVEL.survival",e.thievery="PF2EADJUSTMONSTERLEVEL.thievery",e.description="PF2EADJUSTMONSTERLEVEL.description",e.areaDamage="PF2EADJUSTMONSTERLEVEL.areaDamage",e.additionalDamage="PF2EADJUSTMONSTERLEVEL.additionalDamage"}(a||(a={})),function(e){e.d4="d4",e.d6="d6",e.d8="d8",e.d10="d10",e.d12="d12"}(r||(r={})),a.acrobatics,a.arcana,a.athletics,a.crafting,a.deception,a.diplomacy,a.intimidation,a.medicine,a.nature,a.occultism,a.performance,a.religion,a.society,a.stealth,a.survival,a.thievery;const m=[a.str,a.dex,a.con,a.int,a.wis,a.cha],o={[a.hp]:"system.attributes.hp.max",[a.ac]:"system.attributes.ac.value"},l={[a.str]:"system.abilities.str.mod",[a.dex]:"system.abilities.dex.mod",[a.con]:"system.abilities.con.mod",[a.int]:"system.abilities.int.mod",[a.wis]:"system.abilities.wis.mod",[a.cha]:"system.abilities.cha.mod"},s={[a.perception]:"system.attributes.perception.value",[a.fortitude]:"system.saves.fortitude.value",[a.reflex]:"system.saves.reflex.value",[a.will]:"system.saves.will.value"};var h,d,n,g;!function(e){e.extreme="PF2EADJUSTMONSTERLEVEL.extreme",e.high="PF2EADJUSTMONSTERLEVEL.high",e.moderate="PF2EADJUSTMONSTERLEVEL.moderate",e.low="PF2EADJUSTMONSTERLEVEL.low",e.terrible="PF2EADJUSTMONSTERLEVEL.terrible",e.none="PF2EADJUSTMONSTERLEVEL.none"}(h||(h={})),function(e){e.minimum="PF2EADJUSTMONSTERLEVEL.minimum",e.maximum="PF2EADJUSTMONSTERLEVEL.maximum"}(d||(d={})),function(e){e.unlimited="PF2EADJUSTMONSTERLEVEL.unlimited",e.limited="PF2EADJUSTMONSTERLEVEL.limited"}(n||(n={})),function(e){e.any="any",e.above="above",e.below="below",e.sameOnly="sameOnly"}(g||(g={}));const u={abilityScores:{"-1":{[h.extreme]:"4",[h.high]:"3",[h.moderate]:"2",[h.low]:"0"},0:{[h.extreme]:"4",[h.high]:"3",[h.moderate]:"2",[h.low]:"0"},1:{[h.extreme]:"5",[h.high]:"4",[h.moderate]:"3",[h.low]:"1"},2:{[h.extreme]:"5",[h.high]:"4",[h.moderate]:"3",[h.low]:"1"},3:{[h.extreme]:"5",[h.high]:"4",[h.moderate]:"3",[h.low]:"1"},4:{[h.extreme]:"6",[h.high]:"5",[h.moderate]:"3",[h.low]:"2"},5:{[h.extreme]:"6",[h.high]:"5",[h.moderate]:"4",[h.low]:"2"},6:{[h.extreme]:"7",[h.high]:"5",[h.moderate]:"4",[h.low]:"2"},7:{[h.extreme]:"7",[h.high]:"6",[h.moderate]:"4",[h.low]:"2"},8:{[h.extreme]:"7",[h.high]:"6",[h.moderate]:"4",[h.low]:"3"},9:{[h.extreme]:"7",[h.high]:"6",[h.moderate]:"4",[h.low]:"3"},10:{[h.extreme]:"8",[h.high]:"7",[h.moderate]:"5",[h.low]:"3"},11:{[h.extreme]:"8",[h.high]:"7",[h.moderate]:"5",[h.low]:"3"},12:{[h.extreme]:"8",[h.high]:"7",[h.moderate]:"5",[h.low]:"4"},13:{[h.extreme]:"9",[h.high]:"8",[h.moderate]:"5",[h.low]:"4"},14:{[h.extreme]:"9",[h.high]:"8",[h.moderate]:"5",[h.low]:"4"},15:{[h.extreme]:"9",[h.high]:"8",[h.moderate]:"6",[h.low]:"4"},16:{[h.extreme]:"10",[h.high]:"9",[h.moderate]:"6",[h.low]:"5"},17:{[h.extreme]:"10",[h.high]:"9",[h.moderate]:"6",[h.low]:"4"},18:{[h.extreme]:"10",[h.high]:"9",[h.moderate]:"6",[h.low]:"5"},19:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"6",[h.low]:"5"},20:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"7",[h.low]:"6"},21:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"7",[h.low]:"6"},22:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"8",[h.low]:"6"},23:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"8",[h.low]:"6"},24:{[h.extreme]:"13",[h.high]:"12",[h.moderate]:"9",[h.low]:"7"}},hitPoints:{"-1":{[h.high]:"9",[h.moderate]:"7",[h.low]:"5"},0:{[h.high]:"18",[h.moderate]:"15",[h.low]:"12"},1:{[h.high]:"25",[h.moderate]:"20",[h.low]:"15"},2:{[h.high]:"38",[h.moderate]:"30",[h.low]:"23"},3:{[h.high]:"56",[h.moderate]:"45",[h.low]:"34"},4:{[h.high]:"75",[h.moderate]:"60",[h.low]:"45"},5:{[h.high]:"94",[h.moderate]:"75",[h.low]:"56"},6:{[h.high]:"119",[h.moderate]:"95",[h.low]:"71"},7:{[h.high]:"144",[h.moderate]:"115",[h.low]:"86"},8:{[h.high]:"169",[h.moderate]:"135",[h.low]:"101"},9:{[h.high]:"194",[h.moderate]:"155",[h.low]:"116"},10:{[h.high]:"219",[h.moderate]:"175",[h.low]:"131"},11:{[h.high]:"244",[h.moderate]:"195",[h.low]:"146"},12:{[h.high]:"269",[h.moderate]:"215",[h.low]:"161"},13:{[h.high]:"294",[h.moderate]:"235",[h.low]:"176"},14:{[h.high]:"319",[h.moderate]:"255",[h.low]:"191"},15:{[h.high]:"344",[h.moderate]:"275",[h.low]:"206"},16:{[h.high]:"369",[h.moderate]:"295",[h.low]:"221"},17:{[h.high]:"394",[h.moderate]:"315",[h.low]:"236"},18:{[h.high]:"419",[h.moderate]:"335",[h.low]:"251"},19:{[h.high]:"444",[h.moderate]:"355",[h.low]:"266"},20:{[h.high]:"469",[h.moderate]:"375",[h.low]:"281"},21:{[h.high]:"500",[h.moderate]:"400",[h.low]:"300"},22:{[h.high]:"538",[h.moderate]:"430",[h.low]:"323"},23:{[h.high]:"575",[h.moderate]:"460",[h.low]:"345"},24:{[h.high]:"625",[h.moderate]:"500",[h.low]:"375"}},perceptionSaves:{"-1":{[h.extreme]:"9",[h.high]:"8",[h.moderate]:"5",[h.low]:"2",[h.terrible]:"0"},0:{[h.extreme]:"10",[h.high]:"9",[h.moderate]:"6",[h.low]:"3",[h.terrible]:"1"},1:{[h.extreme]:"11",[h.high]:"10",[h.moderate]:"7",[h.low]:"4",[h.terrible]:"2"},2:{[h.extreme]:"12",[h.high]:"11",[h.moderate]:"8",[h.low]:"5",[h.terrible]:"3"},3:{[h.extreme]:"14",[h.high]:"12",[h.moderate]:"9",[h.low]:"6",[h.terrible]:"4"},4:{[h.extreme]:"15",[h.high]:"14",[h.moderate]:"11",[h.low]:"8",[h.terrible]:"6"},5:{[h.extreme]:"17",[h.high]:"15",[h.moderate]:"12",[h.low]:"9",[h.terrible]:"7"},6:{[h.extreme]:"18",[h.high]:"17",[h.moderate]:"14",[h.low]:"11",[h.terrible]:"8"},7:{[h.extreme]:"20",[h.high]:"18",[h.moderate]:"15",[h.low]:"12",[h.terrible]:"10"},8:{[h.extreme]:"21",[h.high]:"19",[h.moderate]:"16",[h.low]:"13",[h.terrible]:"11"},9:{[h.extreme]:"23",[h.high]:"21",[h.moderate]:"18",[h.low]:"15",[h.terrible]:"12"},10:{[h.extreme]:"24",[h.high]:"22",[h.moderate]:"19",[h.low]:"16",[h.terrible]:"14"},11:{[h.extreme]:"26",[h.high]:"24",[h.moderate]:"21",[h.low]:"18",[h.terrible]:"15"},12:{[h.extreme]:"27",[h.high]:"25",[h.moderate]:"22",[h.low]:"19",[h.terrible]:"16"},13:{[h.extreme]:"29",[h.high]:"26",[h.moderate]:"23",[h.low]:"20",[h.terrible]:"18"},14:{[h.extreme]:"30",[h.high]:"28",[h.moderate]:"25",[h.low]:"22",[h.terrible]:"19"},15:{[h.extreme]:"32",[h.high]:"29",[h.moderate]:"26",[h.low]:"23",[h.terrible]:"20"},16:{[h.extreme]:"33",[h.high]:"30",[h.moderate]:"28",[h.low]:"25",[h.terrible]:"22"},17:{[h.extreme]:"35",[h.high]:"32",[h.moderate]:"29",[h.low]:"26",[h.terrible]:"23"},18:{[h.extreme]:"36",[h.high]:"33",[h.moderate]:"30",[h.low]:"27",[h.terrible]:"24"},19:{[h.extreme]:"38",[h.high]:"35",[h.moderate]:"32",[h.low]:"29",[h.terrible]:"26"},20:{[h.extreme]:"39",[h.high]:"36",[h.moderate]:"33",[h.low]:"30",[h.terrible]:"27"},21:{[h.extreme]:"41",[h.high]:"38",[h.moderate]:"35",[h.low]:"32",[h.terrible]:"28"},22:{[h.extreme]:"43",[h.high]:"39",[h.moderate]:"36",[h.low]:"33",[h.terrible]:"30"},23:{[h.extreme]:"44",[h.high]:"40",[h.moderate]:"37",[h.low]:"34",[h.terrible]:"31"},24:{[h.extreme]:"46",[h.high]:"42",[h.moderate]:"38",[h.low]:"36",[h.terrible]:"32"}},armorClass:{"-1":{[h.extreme]:"18",[h.high]:"15",[h.moderate]:"14",[h.low]:"12"},0:{[h.extreme]:"19",[h.high]:"16",[h.moderate]:"15",[h.low]:"13"},1:{[h.extreme]:"19",[h.high]:"16",[h.moderate]:"15",[h.low]:"13"},2:{[h.extreme]:"21",[h.high]:"18",[h.moderate]:"17",[h.low]:"15"},3:{[h.extreme]:"22",[h.high]:"19",[h.moderate]:"18",[h.low]:"16"},4:{[h.extreme]:"24",[h.high]:"21",[h.moderate]:"20",[h.low]:"18"},5:{[h.extreme]:"25",[h.high]:"22",[h.moderate]:"21",[h.low]:"19"},6:{[h.extreme]:"27",[h.high]:"24",[h.moderate]:"23",[h.low]:"21"},7:{[h.extreme]:"28",[h.high]:"25",[h.moderate]:"24",[h.low]:"22"},8:{[h.extreme]:"30",[h.high]:"27",[h.moderate]:"26",[h.low]:"24"},9:{[h.extreme]:"31",[h.high]:"28",[h.moderate]:"27",[h.low]:"25"},10:{[h.extreme]:"33",[h.high]:"30",[h.moderate]:"29",[h.low]:"27"},11:{[h.extreme]:"34",[h.high]:"31",[h.moderate]:"30",[h.low]:"28"},12:{[h.extreme]:"36",[h.high]:"33",[h.moderate]:"32",[h.low]:"30"},13:{[h.extreme]:"37",[h.high]:"34",[h.moderate]:"33",[h.low]:"31"},14:{[h.extreme]:"39",[h.high]:"36",[h.moderate]:"35",[h.low]:"33"},15:{[h.extreme]:"40",[h.high]:"37",[h.moderate]:"36",[h.low]:"34"},16:{[h.extreme]:"42",[h.high]:"39",[h.moderate]:"38",[h.low]:"36"},17:{[h.extreme]:"43",[h.high]:"40",[h.moderate]:"39",[h.low]:"37"},18:{[h.extreme]:"45",[h.high]:"42",[h.moderate]:"41",[h.low]:"39"},19:{[h.extreme]:"46",[h.high]:"43",[h.moderate]:"42",[h.low]:"40"},20:{[h.extreme]:"48",[h.high]:"45",[h.moderate]:"44",[h.low]:"42"},21:{[h.extreme]:"49",[h.high]:"46",[h.moderate]:"45",[h.low]:"43"},22:{[h.extreme]:"51",[h.high]:"48",[h.moderate]:"47",[h.low]:"45"},23:{[h.extreme]:"52",[h.high]:"49",[h.moderate]:"48",[h.low]:"46"},24:{[h.extreme]:"54",[h.high]:"51",[h.moderate]:"50",[h.low]:"48"}},strikeBonus:{"-1":{[h.extreme]:"10",[h.high]:"8",[h.moderate]:"6",[h.low]:"4"},0:{[h.extreme]:"10",[h.high]:"8",[h.moderate]:"6",[h.low]:"4"},1:{[h.extreme]:"11",[h.high]:"9",[h.moderate]:"7",[h.low]:"5"},2:{[h.extreme]:"13",[h.high]:"11",[h.moderate]:"9",[h.low]:"7"},3:{[h.extreme]:"14",[h.high]:"12",[h.moderate]:"10",[h.low]:"8"},4:{[h.extreme]:"16",[h.high]:"14",[h.moderate]:"12",[h.low]:"9"},5:{[h.extreme]:"17",[h.high]:"15",[h.moderate]:"13",[h.low]:"11"},6:{[h.extreme]:"19",[h.high]:"17",[h.moderate]:"15",[h.low]:"12"},7:{[h.extreme]:"20",[h.high]:"18",[h.moderate]:"16",[h.low]:"13"},8:{[h.extreme]:"22",[h.high]:"20",[h.moderate]:"18",[h.low]:"15"},9:{[h.extreme]:"23",[h.high]:"21",[h.moderate]:"19",[h.low]:"16"},10:{[h.extreme]:"25",[h.high]:"23",[h.moderate]:"21",[h.low]:"17"},11:{[h.extreme]:"27",[h.high]:"24",[h.moderate]:"22",[h.low]:"19"},12:{[h.extreme]:"28",[h.high]:"26",[h.moderate]:"24",[h.low]:"20"},13:{[h.extreme]:"29",[h.high]:"27",[h.moderate]:"25",[h.low]:"21"},14:{[h.extreme]:"31",[h.high]:"29",[h.moderate]:"27",[h.low]:"23"},15:{[h.extreme]:"32",[h.high]:"30",[h.moderate]:"28",[h.low]:"24"},16:{[h.extreme]:"34",[h.high]:"32",[h.moderate]:"30",[h.low]:"25"},17:{[h.extreme]:"35",[h.high]:"33",[h.moderate]:"31",[h.low]:"27"},18:{[h.extreme]:"37",[h.high]:"35",[h.moderate]:"33",[h.low]:"28"},19:{[h.extreme]:"38",[h.high]:"36",[h.moderate]:"34",[h.low]:"29"},20:{[h.extreme]:"40",[h.high]:"38",[h.moderate]:"36",[h.low]:"31"},21:{[h.extreme]:"41",[h.high]:"39",[h.moderate]:"37",[h.low]:"32"},22:{[h.extreme]:"43",[h.high]:"41",[h.moderate]:"39",[h.low]:"33"},23:{[h.extreme]:"44",[h.high]:"42",[h.moderate]:"40",[h.low]:"35"},24:{[h.extreme]:"46",[h.high]:"44",[h.moderate]:"42",[h.low]:"36"}},strikeDamage:{"-1":{[h.extreme]:"4",[h.high]:"3",[h.moderate]:"3",[h.low]:"2"},0:{[h.extreme]:"6",[h.high]:"5",[h.moderate]:"4",[h.low]:"3"},1:{[h.extreme]:"8",[h.high]:"6",[h.moderate]:"5",[h.low]:"4"},2:{[h.extreme]:"11",[h.high]:"9",[h.moderate]:"8",[h.low]:"6"},3:{[h.extreme]:"15",[h.high]:"12",[h.moderate]:"10",[h.low]:"8"},4:{[h.extreme]:"18",[h.high]:"14",[h.moderate]:"12",[h.low]:"9"},5:{[h.extreme]:"20",[h.high]:"16",[h.moderate]:"13",[h.low]:"11"},6:{[h.extreme]:"23",[h.high]:"18",[h.moderate]:"15",[h.low]:"12"},7:{[h.extreme]:"25",[h.high]:"20",[h.moderate]:"17",[h.low]:"13"},8:{[h.extreme]:"28",[h.high]:"22",[h.moderate]:"18",[h.low]:"15"},9:{[h.extreme]:"30",[h.high]:"24",[h.moderate]:"20",[h.low]:"16"},10:{[h.extreme]:"33",[h.high]:"26",[h.moderate]:"22",[h.low]:"17"},11:{[h.extreme]:"35",[h.high]:"28",[h.moderate]:"23",[h.low]:"19"},12:{[h.extreme]:"38",[h.high]:"30",[h.moderate]:"25",[h.low]:"20"},13:{[h.extreme]:"40",[h.high]:"32",[h.moderate]:"27",[h.low]:"21"},14:{[h.extreme]:"43",[h.high]:"34",[h.moderate]:"28",[h.low]:"23"},15:{[h.extreme]:"45",[h.high]:"36",[h.moderate]:"30",[h.low]:"24"},16:{[h.extreme]:"48",[h.high]:"37",[h.moderate]:"31",[h.low]:"25"},17:{[h.extreme]:"50",[h.high]:"38",[h.moderate]:"32",[h.low]:"26"},18:{[h.extreme]:"53",[h.high]:"40",[h.moderate]:"33",[h.low]:"27"},19:{[h.extreme]:"55",[h.high]:"42",[h.moderate]:"35",[h.low]:"28"},20:{[h.extreme]:"58",[h.high]:"44",[h.moderate]:"37",[h.low]:"29"},21:{[h.extreme]:"60",[h.high]:"46",[h.moderate]:"38",[h.low]:"31"},22:{[h.extreme]:"63",[h.high]:"48",[h.moderate]:"40",[h.low]:"32"},23:{[h.extreme]:"65",[h.high]:"50",[h.moderate]:"42",[h.low]:"33"},24:{[h.extreme]:"68",[h.high]:"52",[h.moderate]:"44",[h.low]:"35"}},strikeDamageRoll:{"-1":{[h.extreme]:"1d6+1",[h.high]:"1d4+1",[h.moderate]:"1d4",[h.low]:"1d4"},0:{[h.extreme]:"1d6+3",[h.high]:"1d6+2",[h.moderate]:"1d4+2",[h.low]:"1d4+1"},1:{[h.extreme]:"1d8+4",[h.high]:"1d6+3",[h.moderate]:"1d6+2",[h.low]:"1d4+2"},2:{[h.extreme]:"1d12+4",[h.high]:"1d10+4",[h.moderate]:"1d8+4",[h.low]:"1d6+3"},3:{[h.extreme]:"1d12+8",[h.high]:"1d10+6",[h.moderate]:"1d8+6",[h.low]:"1d6+5"},4:{[h.extreme]:"2d10+7",[h.high]:"2d8+5",[h.moderate]:"2d6+5",[h.low]:"2d4+4"},5:{[h.extreme]:"2d12+7",[h.high]:"2d8+7",[h.moderate]:"2d6+6",[h.low]:"2d4+6"},6:{[h.extreme]:"2d12+10",[h.high]:"2d8+9",[h.moderate]:"2d6+8",[h.low]:"2d4+7"},7:{[h.extreme]:"2d12+12",[h.high]:"2d10+9",[h.moderate]:"2d8+8",[h.low]:"2d6+6"},8:{[h.extreme]:"2d12+15",[h.high]:"2d10+11",[h.moderate]:"2d8+9",[h.low]:"2d6+8"},9:{[h.extreme]:"2d12+17",[h.high]:"2d10+13",[h.moderate]:"2d8+11",[h.low]:"2d6+9"},10:{[h.extreme]:"2d12+20",[h.high]:"2d12+13",[h.moderate]:"2d10+11",[h.low]:"2d6+10"},11:{[h.extreme]:"2d12+22",[h.high]:"2d12+15",[h.moderate]:"2d10+12",[h.low]:"2d8+10"},12:{[h.extreme]:"3d12+19",[h.high]:"3d10+14",[h.moderate]:"3d8+12",[h.low]:"3d6+10"},13:{[h.extreme]:"3d12+21",[h.high]:"3d10+16",[h.moderate]:"3d8+14",[h.low]:"3d6+11"},14:{[h.extreme]:"3d12+24",[h.high]:"3d10+18",[h.moderate]:"3d8+15",[h.low]:"3d6+13"},15:{[h.extreme]:"3d12+26",[h.high]:"3d12+17",[h.moderate]:"3d10+14",[h.low]:"3d6+14"},16:{[h.extreme]:"3d12+29",[h.high]:"3d12+18",[h.moderate]:"3d10+15",[h.low]:"3d6+15"},17:{[h.extreme]:"3d12+31",[h.high]:"3d12+19",[h.moderate]:"3d10+16",[h.low]:"3d6+16"},18:{[h.extreme]:"3d12+34",[h.high]:"3d12+20",[h.moderate]:"3d10+17",[h.low]:"3d6+17"},19:{[h.extreme]:"4d12+29",[h.high]:"4d10+20",[h.moderate]:"4d8+17",[h.low]:"4d6+14"},20:{[h.extreme]:"4d12+32",[h.high]:"4d10+22",[h.moderate]:"4d8+19",[h.low]:"4d6+15"},21:{[h.extreme]:"4d12+34",[h.high]:"4d10+24",[h.moderate]:"4d8+20",[h.low]:"4d6+17"},22:{[h.extreme]:"4d12+37",[h.high]:"4d10+26",[h.moderate]:"4d8+22",[h.low]:"4d6+18"},23:{[h.extreme]:"4d12+39",[h.high]:"4d12+24",[h.moderate]:"4d10+20",[h.low]:"4d6+19"},24:{[h.extreme]:"4d12+42",[h.high]:"4d12+26",[h.moderate]:"4d10+22",[h.low]:"4d6+21"}},spellcasting:{"-1":{[h.extreme]:"11",[h.high]:"8",[h.moderate]:"5"},0:{[h.extreme]:"11",[h.high]:"8",[h.moderate]:"5"},1:{[h.extreme]:"12",[h.high]:"9",[h.moderate]:"6"},2:{[h.extreme]:"14",[h.high]:"10",[h.moderate]:"7"},3:{[h.extreme]:"15",[h.high]:"12",[h.moderate]:"9"},4:{[h.extreme]:"17",[h.high]:"13",[h.moderate]:"10"},5:{[h.extreme]:"18",[h.high]:"14",[h.moderate]:"11"},6:{[h.extreme]:"19",[h.high]:"16",[h.moderate]:"13"},7:{[h.extreme]:"21",[h.high]:"17",[h.moderate]:"14"},8:{[h.extreme]:"22",[h.high]:"18",[h.moderate]:"15"},9:{[h.extreme]:"24",[h.high]:"20",[h.moderate]:"17"},10:{[h.extreme]:"25",[h.high]:"21",[h.moderate]:"18"},11:{[h.extreme]:"26",[h.high]:"22",[h.moderate]:"19"},12:{[h.extreme]:"28",[h.high]:"24",[h.moderate]:"21"},13:{[h.extreme]:"29",[h.high]:"25",[h.moderate]:"22"},14:{[h.extreme]:"31",[h.high]:"26",[h.moderate]:"23"},15:{[h.extreme]:"32",[h.high]:"28",[h.moderate]:"25"},16:{[h.extreme]:"33",[h.high]:"29",[h.moderate]:"26"},17:{[h.extreme]:"35",[h.high]:"30",[h.moderate]:"27"},18:{[h.extreme]:"36",[h.high]:"32",[h.moderate]:"29"},19:{[h.extreme]:"38",[h.high]:"33",[h.moderate]:"30"},20:{[h.extreme]:"39",[h.high]:"34",[h.moderate]:"31"},21:{[h.extreme]:"40",[h.high]:"36",[h.moderate]:"33"},22:{[h.extreme]:"42",[h.high]:"37",[h.moderate]:"34"},23:{[h.extreme]:"43",[h.high]:"38",[h.moderate]:"35"},24:{[h.extreme]:"44",[h.high]:"40",[h.moderate]:"37"}},spellDC:{"-1":{[h.extreme]:"19",[h.high]:"16",[h.moderate]:"13"},0:{[h.extreme]:"19",[h.high]:"16",[h.moderate]:"13"},1:{[h.extreme]:"20",[h.high]:"17",[h.moderate]:"14"},2:{[h.extreme]:"22",[h.high]:"18",[h.moderate]:"15"},3:{[h.extreme]:"23",[h.high]:"20",[h.moderate]:"17"},4:{[h.extreme]:"25",[h.high]:"21",[h.moderate]:"18"},5:{[h.extreme]:"26",[h.high]:"22",[h.moderate]:"19"},6:{[h.extreme]:"27",[h.high]:"24",[h.moderate]:"21"},7:{[h.extreme]:"29",[h.high]:"25",[h.moderate]:"22"},8:{[h.extreme]:"30",[h.high]:"26",[h.moderate]:"23"},9:{[h.extreme]:"32",[h.high]:"28",[h.moderate]:"25"},10:{[h.extreme]:"33",[h.high]:"29",[h.moderate]:"26"},11:{[h.extreme]:"34",[h.high]:"30",[h.moderate]:"27"},12:{[h.extreme]:"36",[h.high]:"32",[h.moderate]:"29"},13:{[h.extreme]:"37",[h.high]:"33",[h.moderate]:"30"},14:{[h.extreme]:"39",[h.high]:"34",[h.moderate]:"31"},15:{[h.extreme]:"40",[h.high]:"36",[h.moderate]:"33"},16:{[h.extreme]:"41",[h.high]:"37",[h.moderate]:"34"},17:{[h.extreme]:"43",[h.high]:"38",[h.moderate]:"35"},18:{[h.extreme]:"44",[h.high]:"40",[h.moderate]:"37"},19:{[h.extreme]:"46",[h.high]:"41",[h.moderate]:"38"},20:{[h.extreme]:"47",[h.high]:"42",[h.moderate]:"39"},21:{[h.extreme]:"48",[h.high]:"44",[h.moderate]:"41"},22:{[h.extreme]:"50",[h.high]:"45",[h.moderate]:"42"},23:{[h.extreme]:"51",[h.high]:"46",[h.moderate]:"43"},24:{[h.extreme]:"52",[h.high]:"48",[h.moderate]:"45"}},skills:{"-1":{[h.extreme]:"8",[h.high]:"5",[h.moderate]:"4",[h.low]:"2"},0:{[h.extreme]:"9",[h.high]:"6",[h.moderate]:"5",[h.low]:"3"},1:{[h.extreme]:"10",[h.high]:"7",[h.moderate]:"6",[h.low]:"4"},2:{[h.extreme]:"11",[h.high]:"8",[h.moderate]:"7",[h.low]:"5"},3:{[h.extreme]:"13",[h.high]:"10",[h.moderate]:"9",[h.low]:"6"},4:{[h.extreme]:"15",[h.high]:"12",[h.moderate]:"10",[h.low]:"8"},5:{[h.extreme]:"16",[h.high]:"13",[h.moderate]:"12",[h.low]:"9"},6:{[h.extreme]:"18",[h.high]:"15",[h.moderate]:"13",[h.low]:"10"},7:{[h.extreme]:"20",[h.high]:"17",[h.moderate]:"15",[h.low]:"12"},8:{[h.extreme]:"21",[h.high]:"18",[h.moderate]:"16",[h.low]:"13"},9:{[h.extreme]:"23",[h.high]:"20",[h.moderate]:"18",[h.low]:"14"},10:{[h.extreme]:"25",[h.high]:"22",[h.moderate]:"19",[h.low]:"16"},11:{[h.extreme]:"26",[h.high]:"23",[h.moderate]:"21",[h.low]:"18"},12:{[h.extreme]:"28",[h.high]:"25",[h.moderate]:"22",[h.low]:"19"},13:{[h.extreme]:"30",[h.high]:"27",[h.moderate]:"24",[h.low]:"21"},14:{[h.extreme]:"31",[h.high]:"28",[h.moderate]:"25",[h.low]:"22"},15:{[h.extreme]:"33",[h.high]:"30",[h.moderate]:"27",[h.low]:"23"},16:{[h.extreme]:"35",[h.high]:"32",[h.moderate]:"28",[h.low]:"25"},17:{[h.extreme]:"36",[h.high]:"33",[h.moderate]:"30",[h.low]:"26"},18:{[h.extreme]:"38",[h.high]:"35",[h.moderate]:"31",[h.low]:"28"},19:{[h.extreme]:"40",[h.high]:"37",[h.moderate]:"33",[h.low]:"29"},20:{[h.extreme]:"41",[h.high]:"38",[h.moderate]:"34",[h.low]:"30"},21:{[h.extreme]:"43",[h.high]:"40",[h.moderate]:"36",[h.low]:"31"},22:{[h.extreme]:"45",[h.high]:"42",[h.moderate]:"37",[h.low]:"32"},23:{[h.extreme]:"46",[h.high]:"43",[h.moderate]:"38",[h.low]:"34"},24:{[h.extreme]:"48",[h.high]:"45",[h.moderate]:"40",[h.low]:"36"}},resistWeak:{"-1":{[d.minimum]:"1",[d.maximum]:"1"},0:{[d.minimum]:"1",[d.maximum]:"3"},1:{[d.minimum]:"2",[d.maximum]:"3"},2:{[d.minimum]:"2",[d.maximum]:"5"},3:{[d.minimum]:"3",[d.maximum]:"6"},4:{[d.minimum]:"4",[d.maximum]:"7"},5:{[d.minimum]:"4",[d.maximum]:"8"},6:{[d.minimum]:"5",[d.maximum]:"9"},7:{[d.minimum]:"5",[d.maximum]:"10"},8:{[d.minimum]:"6",[d.maximum]:"11"},9:{[d.minimum]:"6",[d.maximum]:"12"},10:{[d.minimum]:"7",[d.maximum]:"13"},11:{[d.minimum]:"7",[d.maximum]:"14"},12:{[d.minimum]:"8",[d.maximum]:"15"},13:{[d.minimum]:"8",[d.maximum]:"16"},14:{[d.minimum]:"9",[d.maximum]:"17"},15:{[d.minimum]:"9",[d.maximum]:"18"},16:{[d.minimum]:"9",[d.maximum]:"19"},17:{[d.minimum]:"10",[d.maximum]:"19"},18:{[d.minimum]:"10",[d.maximum]:"20"},19:{[d.minimum]:"11",[d.maximum]:"21"},20:{[d.minimum]:"11",[d.maximum]:"22"},21:{[d.minimum]:"12",[d.maximum]:"23"},22:{[d.minimum]:"12",[d.maximum]:"24"},23:{[d.minimum]:"13",[d.maximum]:"25"},24:{[d.minimum]:"13",[d.maximum]:"26"}},areaDamage:{"-1":{[n.unlimited]:"2",[n.limited]:"4"},0:{[n.unlimited]:"4",[n.limited]:"6"},1:{[n.unlimited]:"5",[n.limited]:"7"},2:{[n.unlimited]:"7",[n.limited]:"11"},3:{[n.unlimited]:"9",[n.limited]:"14"},4:{[n.unlimited]:"11",[n.limited]:"18"},5:{[n.unlimited]:"12",[n.limited]:"21"},6:{[n.unlimited]:"14",[n.limited]:"25"},7:{[n.unlimited]:"15",[n.limited]:"28"},8:{[n.unlimited]:"17",[n.limited]:"32"},9:{[n.unlimited]:"18",[n.limited]:"35"},10:{[n.unlimited]:"20",[n.limited]:"39"},11:{[n.unlimited]:"21",[n.limited]:"42"},12:{[n.unlimited]:"23",[n.limited]:"46"},13:{[n.unlimited]:"24",[n.limited]:"49"},14:{[n.unlimited]:"26",[n.limited]:"53"},15:{[n.unlimited]:"27",[n.limited]:"56"},16:{[n.unlimited]:"28",[n.limited]:"60"},17:{[n.unlimited]:"29",[n.limited]:"63"},18:{[n.unlimited]:"30",[n.limited]:"67"},19:{[n.unlimited]:"32",[n.limited]:"70"},20:{[n.unlimited]:"33",[n.limited]:"74"},21:{[n.unlimited]:"35",[n.limited]:"77"},22:{[n.unlimited]:"36",[n.limited]:"81"},23:{[n.unlimited]:"38",[n.limited]:"84"},24:{[n.unlimited]:"39",[n.limited]:"88"}},additionalDamage:{"-1":{[h.low]:"2",[h.moderate]:"3",[h.high]:"4",[h.extreme]:"5"},0:{[h.low]:"3",[h.moderate]:"4",[h.high]:"5",[h.extreme]:"6"},1:{[h.low]:"3",[h.moderate]:"4",[h.high]:"5",[h.extreme]:"7"},2:{[h.low]:"4",[h.moderate]:"5",[h.high]:"6",[h.extreme]:"8"},3:{[h.low]:"4",[h.moderate]:"6",[h.high]:"7",[h.extreme]:"9"},4:{[h.low]:"5",[h.moderate]:"6",[h.high]:"8",[h.extreme]:"10"},5:{[h.low]:"5",[h.moderate]:"7",[h.high]:"9",[h.extreme]:"11"},6:{[h.low]:"5",[h.moderate]:"7",[h.high]:"10",[h.extreme]:"12"},7:{[h.low]:"6",[h.moderate]:"8",[h.high]:"10",[h.extreme]:"12"},8:{[h.low]:"6",[h.moderate]:"8",[h.high]:"11",[h.extreme]:"13"},9:{[h.low]:"6",[h.moderate]:"9",[h.high]:"11",[h.extreme]:"14"},10:{[h.low]:"7",[h.moderate]:"9",[h.high]:"12",[h.extreme]:"14"},11:{[h.low]:"7",[h.moderate]:"10",[h.high]:"12",[h.extreme]:"15"},12:{[h.low]:"7",[h.moderate]:"10",[h.high]:"13",[h.extreme]:"16"},13:{[h.low]:"8",[h.moderate]:"11",[h.high]:"14",[h.extreme]:"17"},14:{[h.low]:"8",[h.moderate]:"11",[h.high]:"14",[h.extreme]:"17"},15:{[h.low]:"8",[h.moderate]:"11",[h.high]:"15",[h.extreme]:"18"},16:{[h.low]:"8",[h.moderate]:"12",[h.high]:"15",[h.extreme]:"19"},17:{[h.low]:"9",[h.moderate]:"12",[h.high]:"16",[h.extreme]:"19"},18:{[h.low]:"9",[h.moderate]:"13",[h.high]:"16",[h.extreme]:"20"},19:{[h.low]:"9",[h.moderate]:"13",[h.high]:"17",[h.extreme]:"21"},20:{[h.low]:"10",[h.moderate]:"14",[h.high]:"17",[h.extreme]:"21"},21:{[h.low]:"10",[h.moderate]:"14",[h.high]:"18",[h.extreme]:"22"},22:{[h.low]:"10",[h.moderate]:"14",[h.high]:"19",[h.extreme]:"23"},23:{[h.low]:"11",[h.moderate]:"15",[h.high]:"19",[h.extreme]:"23"},24:{[h.low]:"11",[h.moderate]:"15",[h.high]:"20",[h.extreme]:"24"}}},c={[a.str]:u.abilityScores,[a.dex]:u.abilityScores,[a.con]:u.abilityScores,[a.int]:u.abilityScores,[a.wis]:u.abilityScores,[a.cha]:u.abilityScores,[a.hp]:u.hitPoints,[a.perception]:u.perceptionSaves,[a.ac]:u.armorClass,[a.resistWeak]:u.resistWeak,[a.fortitude]:u.perceptionSaves,[a.reflex]:u.perceptionSaves,[a.will]:u.perceptionSaves,[a.strikeBonus]:u.strikeBonus,[a.strikeDamage]:u.strikeDamage,[a.spellcasting]:u.spellcasting,[a.spellDC]:u.spellDC,[a.acrobatics]:u.skills,[a.arcana]:u.skills,[a.athletics]:u.skills,[a.crafting]:u.skills,[a.deception]:u.skills,[a.diplomacy]:u.skills,[a.intimidation]:u.skills,[a.medicine]:u.skills,[a.nature]:u.skills,[a.occultism]:u.skills,[a.performance]:u.skills,[a.religion]:u.skills,[a.society]:u.skills,[a.stealth]:u.skills,[a.survival]:u.skills,[a.thievery]:u.skills,[a.areaDamage]:u.areaDamage,[a.additionalDamage]:u.additionalDamage},x={[r.d4]:2.5,[r.d6]:3.5,[r.d8]:4.5,[r.d10]:5.5,[r.d12]:6.5},w={[a.strikeDamage]:g.any,[a.areaDamage]:g.sameOnly,[a.additionalDamage]:g.sameOnly},E={[a.strikeDamage]:"PF2EADJUSTMONSTERLEVEL.inlineStrikeDamage",[a.areaDamage]:"PF2EADJUSTMONSTERLEVEL.inlineAreaDamage",[a.additionalDamage]:"PF2EADJUSTMONSTERLEVEL.inlineExtraDamage"};function p(e){return game.i18n.localize(e)}function f(e,t){let i=e,a=t.split(".");for(;a.length>0&&null!=i;)i=i[a[0]],a.splice(0,1);return i}function S(e,t,i,a){let m=e*(1-t),o=0==t?Math.floor:Math.round,l=[r.d4,r.d6,r.d8,r.d10,r.d12];const s=l.indexOf(i);a==g.above&&s>0?l.splice(0,s):a==g.below&&s<l.length-1?l.splice(l.indexOf(i)+1):a==g.sameOnly&&l.splice(0,l.length);let h=Math.max(o(m/x[i]),1),d=i,n=Math.abs(h*x[i]-m);for(const e of l){const t=x[e];let i=Math.max(o(m/t),1),a=Math.abs(i*t-m);a<n&&(h=i,d=e,n=a)}return{roll:`${h}${d}`,damage:x[d]*h,numDice:h,dieSize:d}}function b(e,t){let i=[n.unlimited,n.limited,d.minimum,d.maximum,h.terrible,h.low,h.moderate,h.high,h.extreme];i=i.filter((e=>e in t));for(let a=0;a<i.length-1;a++){if(e<a+1&&0!=a)continue;if(e>a+2&&a!=i.length-2)continue;const r=e-(a+1);let m=parseInt(t[i[a]]),o=parseInt(t[i[a+1]]);return Math.round(r*(o-m)+m)}return 0}function T(e,t,i=-9999){let a=[n.unlimited,n.limited,d.minimum,d.maximum,h.terrible,h.low,h.moderate,h.high,h.extreme];if(a=a.filter((e=>e in t)),-9999===i&&(i=parseInt(t[a[0]])),e<i)return{value:-9999,display:"",flag:!1};for(let i=0;i<a.length-1;i++){const r=parseInt(t[a[i]]),m=parseInt(t[a[i+1]]);if(e>=r&&e<m||0==i&&e<r||i==a.length-2&&e>=m){let t=(e-r)/(m-r);t=Math.round(10*t)/10;let o=p(a[i]),l=t;return t>=1&&(o=p(a[i+1]),l-=1),0!=l&&(l>0&&(o+="+"),o+=l.toFixed(1)),{value:t+i+1,display:o,flag:t<0||t>1}}}return{value:-9999,display:"",flag:!1}}function D(e){let t=0,i=0,a="";const r=e.indexOf("+"),m=e.indexOf("d");if((r>=0||-1==m)&&(i=parseInt(e.substring(r+1)),t+=i,r>=0&&(e=e.substring(0,r))),m>=0){let i=e.substring(0,m);a=e.substring(m).trim(),t+=parseInt(i)*x[a]}return{total:t,dieSize:a,flatFraction:i/t}}const y={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let L;const M=new Uint8Array(16);function O(){if(!L&&(L="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!L))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return L(M)}const v=[];for(let e=0;e<256;++e)v.push((e+256).toString(16).slice(1));const A=function(e,t,i){if(y.randomUUID&&!t&&!e)return y.randomUUID();const a=(e=e||{}).random||(e.rng||O)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=a[e];return t}return function(e,t=0){return(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase()}(a)};class F{constructor(e){this.adjustments=[],this.displayName=e}}class R{constructor(e){this.apply=!0,this.metadata={},Object.assign(this,e),this.id=A()}}function V(e,t,i){let a=c[i.statistic][e],r={[i.targetAttribute]:b(i.normalizedValue,a)};t.data=mergeObject(t.data,r)}function N(e,t,i,a){let r=c[i.statistic][e],m=i.targetAttribute.indexOf(a),o=i.targetAttribute.substring(m+a.length+1);i.targetAttribute=i.targetAttribute.substring(0,m);let l=parseInt(a.substring(1,a.length-1)),s=f(t.data,i.targetAttribute);if(!s){let e=f(i.targetDocument,i.targetAttribute);s=JSON.parse(JSON.stringify(e))}s[l][o]=b(i.normalizedValue,r);let h={[i.targetAttribute]:s};t.data=mergeObject(t.data,h)}function U(e,t,i,a){const r=i.metadata;let m=c[i.statistic][e],o=b(i.normalizedValue,m),l={},s=f(i.targetDocument,i.targetAttribute);for(const[e]of Object.entries(s)){let t=r.components.get(e);if(!t)continue;let m=t.totalFraction*o,s="";if(t.flatFraction<1){let e=a?g.above:g.below;r.allowDice!=g.any&&(e=r.allowDice);let i=S(m,t.flatFraction,t.dieSize,e);s=i.roll,m-=i.damage}t.flatFraction>0&&t.flatFraction<1&&(s+="+"),t.flatFraction>0&&(s+=`${Math.floor(m)}`),l[`${i.targetAttribute}.${e}.damage`]=s}t.data=mergeObject(t.data,l)}function J(e,t,i,a){const r=i.metadata,m=c[r.statisticTable][e];let o="",l="";if("InlineCheck"==r.macroType){let e=r.originalCheck.clone();e.dc=b(i.normalizedValue,m),o=r.replaceText,l=e.toInlineString()}else if("InlineRoll"==r.macroType){const e=r;let t=b(i.normalizedValue,m),s=e.originalRoll.clone();s.rolls.splice(0);for(const i of e.components){let r=i.totalFraction*t,m=i.rollData.clone();if(i.flatFraction<1){let t=a?g.above:g.below;e.allowDice!=g.any&&(t=e.allowDice);let o=S(r,i.flatFraction,i.rollData.dieSize,t);m.dieSize=o.dieSize,m.numDice=o.numDice,r-=o.damage}i.flatFraction>0&&(m.flatModifier=Math.floor(r)),s.rolls.push(m)}o=r.replaceText,l=s.toInlineRollString()}if(""!==o&&""!==l){let e=f(t.data,i.targetAttribute);e||(e=f(i.targetDocument,i.targetAttribute)),e=e.replace(o,l);let a={[i.targetAttribute]:e};t.data=mergeObject(t.data,a)}}class P{constructor(){this.numDice=0,this.flatModifier=0,this.damageType="",this.chatLabel=""}clone(){let e=new P;return e.numDice=this.numDice,e.dieSize=this.dieSize,e.flatModifier=this.flatModifier,e.damageType=this.damageType,e.chatLabel=this.chatLabel,e}toSimpleString(){let e="";return this.dieSize&&this.numDice>0&&(e=this.numDice.toString()+this.dieSize),e.length>0&&this.flatModifier>0&&(e+="+"),this.flatModifier>0&&(e+=this.flatModifier.toString()),e}toInlineRollString(e=""){return 0==e.length&&(e=this.toSimpleString()),this.flatModifier>0&&this.numDice>0&&(e=`(${e})`),this.damageType.length>0&&(e+=`[${this.damageType}]`),this.chatLabel.length>0&&(e+=` #${this.chatLabel}`),e}}class k{constructor(){this.hasTrailingLabel=!1,this.blind=!1,this.isDamage=!1,this.rolls=[]}static parse(e){let t=new k;const i=e.match(/](\{[^{}[\]]*})$/);if(i){t.hasTrailingLabel=!0;const a=e.lastIndexOf("{");e=e.substring(0,a);let r=p("PF2EADJUSTMONSTERLEVEL.damageInline");i[1].includes(r)&&(t.isDamage=!0)}e.match(/^\[{2}\/b/)&&(t.blind=!0);let a=(e=(e=(e=(e=e.replace(/^\[{2}\/b?r/,"").replace(/]{2}$/,"")).trim()).replace(/^\{*/,"").replace(/}*$/,"")).trim()).split(",");for(let e of a){e=e.trim();let i=e.match(/#(.*)/);i&&(e=e.replace(i[0],""),e=e.trim());let a=e.match(/\[(\w+)]$/);a&&(e=e.replace(a[0],""),t.isDamage=!0),e=e.trim(),e=e.replace(/^\(/,"").replace(/\)$/,""),e=e.replace(/\s+/g,"");let r=e.indexOf("+"),m=e.indexOf("d"),o=new P;o.damageType=a?a[1]:"",o.chatLabel=i?i[1]:"",m>=1&&(o.numDice=parseInt(e.substring(0,m)),o.dieSize=e.substring(m,r>m?r:void 0),e=r>m?e.substring(r+1):""),o.flatModifier=parseInt(e),Number.isFinite(o.flatModifier)||(o.flatModifier=0),t.rolls.push(o)}return t}clone(){let e=new k;e.isDamage=this.isDamage,e.blind=this.blind,e.hasTrailingLabel=this.hasTrailingLabel;for(const t of this.rolls)e.rolls.push(t.clone());return e}toReadableString(){let e="";for(let t=0;t<this.rolls.length;t++){const i=this.rolls[t];t>0&&(e+=" plus "),e+=i.toSimpleString(),this.isDamage&&(e+=" ",e+=i.damageType.length>0?i.damageType:p("PF2EADJUSTMONSTERLEVEL.damageInline"))}return e}toInlineRollString(){let e="",t="";for(let i=0;i<this.rolls.length;i++){const a=this.rolls[i];let r=a.toSimpleString(),m=a.toInlineRollString(r);i>0&&(e+=",",t+=" "+p("PF2EADJUSTMONSTERLEVEL.plusInline")+" "),t+=r,a.damageType.length>0&&(t+=" "+a.damageType),this.isDamage&&(t+=" "+p("PF2EADJUSTMONSTERLEVEL.damageInline")),e+=m}return this.rolls.length>1&&(e=`{${e}}`),e=`[[/${this.blind?"b":""}r ${e}]]`,this.hasTrailingLabel&&(e+=`{${t}}`),e}}k.pattern=/\[{2}\/b?r(?:.(?!\[{2}))*]{2}(?:\{[^}]*})?/g;class j{constructor(e){Object.assign(this,e)}}class I extends j{}class z extends I{get macroType(){return"InlineRoll"}}class C extends j{constructor(){super(),this.components=new Map}}class B extends I{get macroType(){return"InlineCheck"}}class H{constructor(){this.type="",this.dc="",this.basic=!1,this.adjustment="",this.immutable=!1,this.name="",this.traits="",this.overrideTraits=!1,this.trailingLabel=""}static parse(e){let t=new H;if(e.match(/](\{[^{}[\]]*})$/)){const i=e.lastIndexOf("{");t.trailingLabel=e.substring(i+1,e.length-1),e=e.substring(0,i)}const i=(e=e.substring(7,e.length-1).trim()).split("|");for(const e of i){const i=e.indexOf(":"),a=e.substring(0,i),r=e.substring(i+1);"type"==a?t.type=r:"dc"==a?r.match(/\d+/)?t.dc=parseInt(r):t.dc=r:"basic"==a?t.basic=!0:"adjustment"==a?t.adjustment=r:"immutable"==a?t.immutable=!0:"name"==a?t.name=r:"traits"==a?t.traits=r:"overrideTraits"==a&&(t.overrideTraits=!0)}return t}clone(){let e=new H;return e.type=this.type,e.dc=this.dc,e.basic=this.basic,e.adjustment=this.adjustment,e.immutable=this.immutable,e.name=this.name,e.traits=this.traits,e.overrideTraits=this.overrideTraits,e.trailingLabel=this.trailingLabel,e}toReadableString(){return`DC ${Number.isFinite(this.dc)?this.dc:"(calculated)"} ${p("PF2EADJUSTMONSTERLEVEL."+this.type)}`}toInlineString(){let e=[];this.type.length>0&&e.push(`type:${this.type}`),e.push(`dc:${this.dc}`),this.basic&&e.push("basic:true"),this.adjustment.length>0&&e.push(`adjustment:${this.adjustment}`),this.immutable&&e.push("immutable:true"),this.name.length>0&&e.push(`name:${this.name}`),this.traits.length>0&&e.push(`traits:${this.traits}`),this.overrideTraits&&e.push("overrideTraits:true");let t="@Check["+e.join("|")+"]";return this.trailingLabel&&(t+=`{${this.trailingLabel}}`),t}}H.pattern=/@Check\[[^\]]*](?:\{[^}]*})?/g;const W=/@Template/;function q(e,t,i){const a=c[t][e.level];let r=f(e.actor,i),o=new j,l=T(r,a,-20);if(l.value>-9999){const a=r<1&&m.includes(t);return l.flag&&(o.outOfRange=!0),a&&(o.dumpStat=!0),new R({targetDocument:e.actor,targetAttribute:i,normalizedValue:l.value,displayValue:l.display,statistic:t,apply:!a,metadata:o})}return null}function G(e,t,i){const r=c[a.resistWeak][e.level];let m={},o=T(t.value,r,1);return o.flag&&(m.outOfRange=!0),new R({targetDocument:e.actor,targetAttribute:i,statistic:a.resistWeak,normalizedValue:o.value,displayValue:o.display,displayName:t.type,metadata:m})}function _(e,t,i,r){const m=c[t][e.level];let o,l=0;if("lore"==i.type||"spellcastingEntry"==i.type||"melee"==i.type&&t==a.strikeBonus)o=new j,l=f(i,r);else{if("melee"!=i.type||t!=a.strikeDamage)return null;{let t=new C;o=t;let a=0;const r=null!=e.actor.inventory.find((e=>e.name.includes(i.name)));t.allowDice=r?g.sameOnly:g.any;for(let[e,r]of Object.entries(i.system.damageRolls)){let i=D(r.damage);a+=i.total,t.components.set(e,{totalFraction:i.total,flatFraction:i.flatFraction,dieSize:i.dieSize})}l=Math.ceil(a);for(const[e,i]of t.components)i.totalFraction/=a}}let s=T(l,m,1);return s.value>-9999?(s.flag&&(o.outOfRange=!0),new R({targetDocument:i,targetAttribute:r,statistic:t,normalizedValue:s.value,displayValue:s.display,metadata:o})):null}function K(e,t,i){let r=[],m=f(t,i),o=m.matchAll(H.pattern),l=m.matchAll(k.pattern);for(const o of l){if(o[0].includes("d20"))continue;const l=k.parse(o[0]);if(!l.isDamage)continue;let s=[],h=m.match(W)?a.areaDamage:a.strikeDamage;h!=a.strikeDamage||1!=l.rolls.length||0!=l.rolls[0].flatModifier&&0!=l.rolls[0].numDice||(h=a.additionalDamage);let d=c[h][e],n=0;for(const e of l.rolls){let t=D(e.toSimpleString());n+=t.total,s.push({rollData:e,totalFraction:t.total,flatFraction:t.flatFraction})}let g=Math.ceil(n);for(const e of s)e.totalFraction/=n;let u=T(g,d,1);if(u.value>-9999){let e=new z({replaceText:o[0],statisticTable:h,components:s,originalRoll:l,allowDice:w[h],damageTypeLabel:E[h]});u.flag&&(e.outOfRange=!0);let m=l.toReadableString(),d=new R({targetDocument:t,targetAttribute:i,statistic:a.description,normalizedValue:u.value,displayValue:u.display,displayName:`Text: Roll ${m}`,metadata:e});r.push(d)}}const s=c[a.spellDC][e];for(const e of o){const m=H.parse(e[0]);if(Number.isFinite(m.dc)){let o=T(m.dc,s,1);if(o.value>-9999){let l=new B({replaceText:e[0],originalCheck:m,statisticTable:a.spellDC});o.flag&&(l.outOfRange=!0);let s=new R({targetDocument:t,targetAttribute:i,statistic:a.description,normalizedValue:o.value,displayValue:o.display,displayName:`Text: Check ${m.toReadableString()}`,metadata:l});r.push(s)}}}return r}const Q=/\[(\d+)]/;class X extends FormApplication{constructor(){super(...arguments),this.data={actor:this.object,level:"-1"},this.DataToModify=[]}static get defaultOptions(){return mergeObject(super.defaultOptions,{classes:["form"],popOut:!0,resizable:!0,template:"modules/pf2e-adjust-monster-level/forms/adjustMonsterLevelForm.html",id:"adjustMonsterLevelForm",title:"Adjust Level Form",height:833,width:400})}async _updateObject(i,r){if(r&&r[a.level]!=this.data.level){let i=this.data.actor.system.details.level.value;this.data.level=r[a.level];let m=[],o={targetDocument:this.data.actor,data:{name:r[a.name]?r[a.name]:this.data.actor.name,"system.details.level.value":parseInt(this.data.level)}};m.push(o);for(const e of this.DataToModify)for(const t of e.adjustments){if(!r["adjustments."+t.id])continue;let e=m.find((e=>e.targetDocument==t.targetDocument));e||(e={targetDocument:t.targetDocument,data:{}},m.push(e));let o=t.targetAttribute.match(Q);o?N(this.data.level,e,t,o[0]):t.statistic==a.strikeDamage?U(this.data.level,e,t,this.data.level>i):t.statistic==a.description?J(this.data.level,e,t,this.data.level>i):V(this.data.level,e,t)}if(game.settings.get(e,t)){console.log(`----- Data deltas for adjusting monster ${this.data.actor.name} ${this.data.actor.system.details.level.value}->${this.data.level} -----`);for(const e of m)console.log(`${e.targetDocument.name}`,e.data)}else{for(const e of m)await e.targetDocument.update(e.data);await this.data.actor.update(this.updateHitPoints())}}}updateHitPoints(){return{"system.attributes.hp.value":this.data.actor.system.attributes.hp.max}}getData(){this.data.level=this.data.actor.system.details.level.value.toString();const e={[a.name]:this.data.actor.name,[a.level]:this.data.level};this.pushActorCategory("Defenses",o),this.pushActorCategory("AbilityModifiers",l),this.pushActorCategory("PerceptionAndSaves",s);let t=this.data.actor;if(t.system.attributes.weaknesses.length>0){let e=new F(p("PF2EADJUSTMONSTERLEVEL.categoryWeaknesses"));for(let i=0;i<t.system.attributes.weaknesses.length;i++){const a=t.system.attributes.weaknesses[i];let r=G(this.data,a,`system.attributes.weaknesses[${i}].value`);e.adjustments.push(r)}this.DataToModify.push(e)}if(t.system.attributes.resistances.length>0){let e=new F(p("PF2EADJUSTMONSTERLEVEL.categoryResistances"));for(let i=0;i<t.system.attributes.resistances.length;i++){const a=t.system.attributes.resistances[i];let r=G(this.data,a,`system.attributes.resistances[${i}].value`);e.adjustments.push(r)}this.DataToModify.push(e)}let r=new F(p("PF2EADJUSTMONSTERLEVEL.categorySkills"));this.DataToModify.push(r);for(const[,e]of this.data.actor.items.entries())if("lore"==e.type&&null!=e.name){let t="PF2EADJUSTMONSTERLEVEL."+e.name.toLowerCase(),i=_(this.data,t,e,"system.mod.value");i&&r.adjustments.push(i)}else if("spellcastingEntry"==e.type&&null!=e.name){let t=_(this.data,a.spellcasting,e,"system.spelldc.value");if(t){let i=new R({targetDocument:t.targetDocument,targetAttribute:"system.spelldc.dc",statistic:a.spellDC,normalizedValue:t.normalizedValue,displayValue:t.displayValue,metadata:JSON.parse(JSON.stringify(t.metadata))}),r=new F(e.name);r.adjustments.push(t),r.adjustments.push(i),this.DataToModify.push(r)}}else if("melee"==e.type&&null!=e.name){let t=_(this.data,a.strikeBonus,e,"system.bonus.value"),i=_(this.data,a.strikeDamage,e,"system.damageRolls"),r=new F(e.name+" Strike");t&&r.adjustments.push(t),i&&r.adjustments.push(i),r.adjustments.length>0&&this.DataToModify.push(r)}else if("action"==e.type&&null!=e.name){let t=K(this.data.level,e,"system.description.value");if(t.length>0){let i=new F(e.name);i.adjustments=t,this.DataToModify.push(i)}}return Handlebars.registerHelper("json",(function(e){return JSON.stringify(e)})),{Levels:i,Current:e,ToModify:JSON.parse(JSON.stringify(this.DataToModify))}}pushActorCategory(e,t){let i=new F(p(`PF2EADJUSTMONSTERLEVEL.category${e}`));for(const[e,a]of Object.entries(t)){let t=q(this.data,e,a);t&&i.adjustments.push(t)}this.DataToModify.push(i)}}Hooks.on("init",(async function(){await game.settings.register(e,"expandFoldout",{scope:"client",config:!1,requiresReload:!1,type:Boolean,default:!1}),await game.settings.register(e,t,{name:"PF2EADJUSTMONSTERLEVEL.SETTINGS.testModeLabel",hint:"PF2EADJUSTMONSTERLEVEL.SETTINGS.testModeHint",scope:"client",config:!0,requiresReload:!1,type:Boolean,default:!1})})),Hooks.on("renderActorSheet",(async function(e,t){let i=e.object;if("npc"!==i?.type)return;if(!i.canUserModify(game.user,"update"))return;let a=t.find(".adjustment-select"),r=$(`<a class="adjustment trait" style>${p("PF2EADJUSTMONSTERLEVEL.ACTORSHEET.buttonlabel")}</a>`);r.on("click",(()=>{new X(i).render(!0)})),a.after(r)}))})();